#!/usr/bin/env python
# d-manager:
#
# This is an entry point of d-manager

import sys
import os


if __name__ == '__main__':
    # モジュール検索パスをセットする
    #
    # シンボリックリンク経由での呼び出しも考慮する。
    # sys.path にはシンボリックリック経由で読み込んでも、
    # リンク先のスクリプトのパスが渡される。
    # ただし、os.getcwd() で取得出来るパスはスクリプト実行時のカレントディレクトリで
    # __file__ はシンボリックリンクのパスになっている。
    # 呼び出し元のシンボリックリンクを辿って、パスをセットする。
    project_workdir = os.path.abspath(os.path.join(os.path.dirname(os.path.realpath(__file__)), os.pardir))
    sys.path.append(project_workdir)
    
    cmd_module = sys.argv[1]
    genre = cmd_module.split('_')[0]

    # rename 'abc_def_ghi' to 'AbcDefGhiCMD'
    l = list()
    for n in cmd_module.split('_'):
        l.append(n.capitalize())
    else:
        cmd_class = '%sCMD' % ''.join(l)

    C_ = getattr(__import__('d_manager.command.%s' % genre,
                            fromlist=[cmd_class]), cmd_class)
    cmd = C_(sys.argv[2:])
    cmd.do()

    sys.exit(0)
